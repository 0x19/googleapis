// Product-search request and response messages.

syntax = "proto3";

package google.cloud.vision.v1;

import "google/api/annotations.proto";
import "google/cloud/vision/v1/geometry.proto";

option java_multiple_files = true;
option java_package = "com.google.cloud.vision.v1";
option java_outer_classname = "ProductSearchProto";
option cc_enable_arenas = true;

// Supported product-search categories.
enum ProductSearchCategory {
  option (google.api.enum_visibility).restriction =
      "PRODUCT_SEARCH_TRUSTED_TESTER";
  PRODUCT_SEARCH_CATEGORY_UNSPECIFIED = 0;
  SHOES = 1;
  HANDBAGS = 2;
}

// Specifies the fields to include in product-search results.
enum ProductSearchResultsView {
  option (google.api.enum_visibility).restriction =
      "PRODUCT_SEARCH_TRUSTED_TESTER";
  // Product-search results contain only `category` and `product_id`.
  // Default value.
  BASIC = 0;

  // Product-search results contain `category`, `product_id`, `image_uri`,
  // and `score`.
  FULL = 1;
}

// Parameters for a product-search request.
message ProductSearchParams {
  option (google.api.message_visibility).restriction =
      "PRODUCT_SEARCH_TRUSTED_TESTER";

  // The resource-name of the catalog to search in.
  string catalog_name = 1;

  // The category to search in.
  // Optional. It is inferred by the system if it is not specified.
  ProductSearchCategory category = 2;

  // The bounding-polygon around the area of interest in the image.
  // Optional. It is inferred by the system if it is not specified.
  // NOTE: currently, the system converts the bounding-polygon into
  // a (non-rotated) bounding-box for internal use.
  BoundingPoly bounding_poly = 3;

  // Specifies the fields to return in product-search results.
  // Optional. Defaults to `BASIC`.
  ProductSearchResultsView view = 4;
}

// Search results for a product-search request.
message ProductSearchResults {
  option (google.api.message_visibility).restriction =
      "PRODUCT_SEARCH_TRUSTED_TESTER";

  message Product {
    option (google.api.message_visibility).restriction =
        "PRODUCT_SEARCH_TRUSTED_TESTER";

    string product_id = 1;

    // The URI of the image which matched the query image.
    // This field will be in the results only if `view` is set to `FULL` in
    // the request.
    string image_uri = 2;

    // A score of how well the image matched the query image.
    // The score ranges from 0 to 1.0.
    // This field will be in the results only if `view` is set to `FULL` in
    // the request.
    float score = 3;
  }

  ProductSearchCategory category = 1;

  // Timestamp (microseconds from epoch) of the index which provided these
  // results.
  int64 index_time_micros = 2;

  repeated Product products = 3;
}