syntax = "proto3";

package google.cloud.vision.v1;

import "google/api/annotations.proto";
import "google/cloud/vision/v1/geometry.proto";

option java_multiple_files = true;
option java_package = "com.google.cloud.vision.v1";
option java_outer_classname = "TextAnnotationProto";
option cc_enable_arenas = true;

// TextAnnotation contains a structured representation of OCR extracted text.
// The hierarchy of an OCR extracted text structure is like this:
//     TextAnnotation -> Page -> Block -> Paragraph -> Word -> Symbol
// Each structural component, starting from Page, may further have their own
// properties. Properties describe detected languages, breaks etc.. Please
// refer to the [google.cloud.vision.v1.TextAnnotation.TextProperty][] message
// definition below for more detail.
message TextAnnotation {
  option (google.api.message_visibility).restriction = "TRUSTED_TESTER";

  // List of pages detected by OCR.
  repeated Page pages = 1;

  // UTF-8 text detected on the pages.
  string text = 2;

  // Detected language for a structural component.
  message DetectedLanguage {
    option (google.api.message_visibility).restriction = "TRUSTED_TESTER";

    // The BCP-47 language code, such as "en-US" or "sr-Latn". For more
    // information, see
    // http://www.unicode.org/reports/tr35/#Unicode_locale_identifier.
    string language_code = 1;

    // Confidence of detected language. Range [0, 1].
    float confidence = 2;
  }

  // Detected start or end of a structural component.
  message DetectedBreak {
    option (google.api.message_visibility).restriction = "TRUSTED_TESTER";

    // Enum to denote the type of break found. New line, space etc.
    enum BreakType {
      option (google.api.enum_visibility).restriction = "TRUSTED_TESTER";

      UNKNOWN = 0;         // Unknown break label type.
      SPACE = 1;           // Regular space.
      SURE_SPACE = 2;      // Sure space (very wide).
      EOL_SURE_SPACE = 3;  // Line-wrapping break.
      HYPHEN = 4;          // End-line hyphen that is not present in text; does
                           // not co-occur with SPACE, LEADER_SPACE, or
                           // LINE_BREAK.
      LINE_BREAK = 5;      // Line break that ends a paragraph.
    }
    BreakType type = 1;

    // True if break prepends the element.
    bool is_prefix = 2;
  }

  // Additional information detected on the structural component.
  message TextProperty {
    option (google.api.message_visibility).restriction = "TRUSTED_TESTER";

    // A list of detected languages together with confidence.
    repeated DetectedLanguage detected_languages = 1;

    // Detected start or end of a text segment.
    DetectedBreak detected_break = 2;
  }
}

// Detected page from OCR.
message Page {
  option (google.api.message_visibility).restriction = "TRUSTED_TESTER";

  // Additional information detected on the page.
  TextAnnotation.TextProperty property = 1;

  // Page width in pixels.
  int32 width = 2;

  // Page height in pixels.
  int32 height = 3;

  // List of blocks of text, images etc on this page.
  repeated Block blocks = 4;
}

// Logical element on the page.
message Block {
  option (google.api.message_visibility).restriction = "TRUSTED_TESTER";

  // Additional information detected for the block.
  TextAnnotation.TextProperty property = 1;

  // The bounding box for the block.
  // The vertices are in the order of top-left, top-right, bottom-right,
  // bottom-left. When a rotation of the bounding box is detected the rotation
  // is represented as around the top-left corner as defined when the text is
  // read in the 'natural' orientation.
  // For example:
  //   * when the text is horizontal it might look like:
  //      0----1
  //      |    |
  //      3----2
  //   * when it's rotated 180 degrees around the top-left corner it becomes:
  //      2----3
  //      |    |
  //      1----0
  //   and the vertice order will still be (0, 1, 2, 3).
  BoundingPoly bounding_box = 2;

  // List of paragraphs in this block (if this blocks is of type text).
  repeated Paragraph paragraphs = 3;

  // Type of a block (text, image etc) as identified by OCR.
  enum BlockType {
    option (google.api.enum_visibility).restriction = "TRUSTED_TESTER";

    UNKNOWN = 0;  // Unknown block type.
    TEXT = 1;     // Regular text block.
    TABLE = 2;    // Table block.
    PICTURE = 3;  // Image block.
    RULER = 4;    // Horizontal/vertical line box.
    BARCODE = 5;  // Barcode block.
  };
  // Detected block type (text, image etc) for this block.
  BlockType block_type = 4;
}

// Structural unit of text representing a number of words in certain order.
message Paragraph {
  option (google.api.message_visibility).restriction = "TRUSTED_TESTER";

  // Additional information detected for the paragraph.
  TextAnnotation.TextProperty property = 1;

  // The bounding box for the paragraph.
  // The vertices are in the order of top-left, top-right, bottom-right,
  // bottom-left. When a rotation of the bounding box is detected the rotation
  // is represented as around the top-left corner as defined when the text is
  // read in the 'natural' orientation.
  // For example:
  //   * when the text is horizontal it might look like:
  //      0----1
  //      |    |
  //      3----2
  //   * when it's rotated 180 degrees around the top-left corner it becomes:
  //      2----3
  //      |    |
  //      1----0
  //   and the vertice order will still be (0, 1, 2, 3).
  BoundingPoly bounding_box = 2;

  // List of words in this paragraph.
  repeated Word words = 3;
}

// A word representation.
message Word {
  option (google.api.message_visibility).restriction = "TRUSTED_TESTER";

  // Additional information detected for the word.
  TextAnnotation.TextProperty property = 1;

  // The bounding box for the word.
  // The vertices are in the order of top-left, top-right, bottom-right,
  // bottom-left. When a rotation of the bounding box is detected the rotation
  // is represented as around the top-left corner as defined when the text is
  // read in the 'natural' orientation.
  // For example:
  //   * when the text is horizontal it might look like:
  //      0----1
  //      |    |
  //      3----2
  //   * when it's rotated 180 degrees around the top-left corner it becomes:
  //      2----3
  //      |    |
  //      1----0
  //   and the vertice order will still be (0, 1, 2, 3).
  BoundingPoly bounding_box = 2;

  // List of symbols in the word.
  // The order of the symbols follows the natural reading order.
  repeated Symbol symbols = 3;
}

// A single symbol representation.
message Symbol {
  option (google.api.message_visibility).restriction = "TRUSTED_TESTER";

  // Additional information detected for the symbol.
  TextAnnotation.TextProperty property = 1;

  // The bounding box for the symbol.
  // The vertices are in the order of top-left, top-right, bottom-right,
  // bottom-left. When a rotation of the bounding box is detected the rotation
  // is represented as around the top-left corner as defined when the text is
  // read in the 'natural' orientation.
  // For example:
  //   * when the text is horizontal it might look like:
  //      0----1
  //      |    |
  //      3----2
  //   * when it's rotated 180 degrees around the top-left corner it becomes:
  //      2----3
  //      |    |
  //      1----0
  //   and the vertice order will still be (0, 1, 2, 3).
  BoundingPoly bounding_box = 2;

  // The actual UTF-8 representation of the symbol.
  string text = 3;
}